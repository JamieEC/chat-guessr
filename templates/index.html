<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nevo1st - Who made the comment?</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background-color: #f4f4f9; 
            color: #333; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
        }
        .title {
            position: absolute;
            top: 0;
            width: 100%;
            text-align: center;
            font-size: 2em;
            margin-top: 10px;
            font-weight: bold;
        }
        .message { 
            margin: 20px; 
            font-size: 1.5em; 
            font-weight: bold; 
            text-align: center; 
        }
        .guesses { 
            margin: 20px; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
        }
        .guess-button { 
            margin: 5px; 
            padding: 10px 20px; 
            font-size: 1em; 
            border: none; 
            border-radius: 5px; 
            background-color: #007bff; 
            color: white; 
            cursor: pointer; 
            transition: background-color 0.3s; 
        }
        .guess-button:hover { 
            background-color: #0056b3; 
        }
        #result { 
            margin-top: 20px; 
            font-size: 1.5em; 
        }
        .correct { 
            color: green; 
        }
        .incorrect { 
            color: red; 
        }
        #score { 
            margin-top: 20px; 
            font-size: 1.2em; 
            font-weight: bold; 
        }
        #lives { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            font-size: 1.5em; 
            font-weight: bold; 
        }
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f4f4f9;
            padding: 20px;
            border: 2px solid #333;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 1000;
        }
        .popup button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .popup button:hover {
            background-color: #0056b3;
        }
        .info-icon {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.3s;
            z-index: 1001;
        }
        .info-icon:hover {
            background-color: #0056b3;
        }
        .tooltip {
            visibility: hidden;
            width: 350px;
            background-color: #333;
            color: #fff;
            font-size: 0.7em;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 50px;
            right: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .lifeline {
            position: fixed;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .lifeline-button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            background-color: #28a745;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 250px;
        }
        .lifeline-button:hover {
            background-color: #218838;
        }
        .disabled {
            background-color: #dc3545;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="title">Nevoguessr - Guess who said this degenerate comment</div>
    <div class="message" id="message"></div>
    <div class="guesses" id="guesses"></div>
    <div id="result"></div>
    <div id="score">Score: 0</div>
    <div id="lives">Lives: 5</div>

    <div class="popup" id="gameOverPopup" style="display: none;">
        <p>You're out of lives! Would you like to try again?</p>
        <button onclick="restartGame()">Try Again</button>
    </div>

    <div class="info-icon">
        ?
        <div class="tooltip">
            Guess the author of each chat message.<br>
            You get 2 guesses per round.<br>
            Losing both guesses costs you a life.<br>
            Get it right on your first try: 100 points<br>
            Get it right on your second try: 50 points
        </div>
    </div>

    <div class="lifeline">
        <button class="lifeline-button" id="fiftyFifty" onclick="useFiftyFifty()">50/50</button>
        <button class="lifeline-button" id="phoneAFriend" onclick="usePhoneAFriend()">Phone a Friend</button>
        <button class="lifeline-button" id="askTheAudience" onclick="useAskTheAudience()">Ask the Audience</button>
    </div>

    
    <script>
        let score = 0;
        let attempts = 0;
        let isAnswered = false;
        let lives = 5;
        let correctUsername = '';
        let guesses = [];

        async function fetchMessage() {
            const response = await fetch('/get_message');
            const data = await response.json();
            document.getElementById('message').innerText = data.message;
            const guessesDiv = document.getElementById('guesses');
            guessesDiv.innerHTML = '';
            correctUsername = data.username;
            guesses = data.guesses;
            guesses.forEach(guess => {
                const button = document.createElement('button');
                button.innerText = guess;
                button.className = 'guess-button';
                button.onclick = () => checkGuess(guess, correctUsername);
                guessesDiv.appendChild(button);
            });
            document.getElementById('result').innerText = '';
            attempts = 0;
            isAnswered = false;
        }

        function useFiftyFifty() {
            const incorrectGuesses = guesses.filter(guess => guess !== correctUsername);
            const toDisable = incorrectGuesses.sort(() => 0.5 - Math.random()).slice(0, 2);
            toDisable.forEach(guess => {
                const button = Array.from(document.getElementsByClassName('guess-button')).find(btn => btn.innerText === guess);
                if (button) {
                    button.classList.add('disabled');
                    button.onclick = null;
                }
            });
            disableButton('fiftyFifty');
        }

        function usePhoneAFriend() {
            disableButton('phoneAFriend');
        }

        function useAskTheAudience() {
            disableButton('askTheAudience');
        }

        function disableButton(buttonId) {
            const button = document.getElementById(buttonId);
            button.classList.add('disabled');
            button.onclick = null;
        }

        function checkGuess(selected, correct) {
            if (isAnswered) return;

            const resultDiv = document.getElementById('result');
            attempts++;
            if (selected === correct) {
                if (attempts === 1) {
                    score += 100;
                } else if (attempts === 2) {
                    score += 50;
                }
                resultDiv.innerText = 'Correct!';
                resultDiv.className = 'correct';
                updateScore();
                isAnswered = true;
                setTimeout(fetchMessage, 1000);
            } else {
                if (attempts > 2) {
                    lives--;
                    updateLives();
                    if (lives <= 0) {
                        showGameOverPopup();
                        return;
                    }
                }
                resultDiv.innerText = 'Wrong! Try again.';
                resultDiv.className = 'incorrect';
            }
        }

        function updateScore() {
            document.getElementById('score').innerText = `Score: ${score}`;
        }

        function updateLives() {
            document.getElementById('lives').innerText = `Lives: ${lives}`;
        }

        function showGameOverPopup() {
            document.getElementById('gameOverPopup').style.display = 'block';
        }

        function restartGame() {
            lives = 5;
            score = 0;
            updateLives();
            updateScore();
            document.getElementById('gameOverPopup').style.display = 'none';
            fetchMessage();
        }

        fetchMessage();
    </script>
    <footer style="position: fixed; bottom: 0; width: 100%; text-align: center; background-color: #f4f4f9; padding: 10px; font-size: 0.8em;">
        Â© 2024 JamieEC. All rights reserved. | <a href="https://github.com/JamieEC/chat-guessr" target="_blank" style="color: #007bff;">GitHub Project</a>
    </footer>
</body>
</html>
